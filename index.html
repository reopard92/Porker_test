<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Poker Flash Recorder</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel (JSX変換用) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #020617; /* slate-950 */
            color: #f1f5f9; /* slate-100 */
        }
        /* スクロールバー非表示 */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        /* iOS下部セーフエリア対応 */
        .pb-safe {
            padding-bottom: env(safe-area-inset-bottom);
        }
    </style>
</head>
<body>

<div id="root"></div>

<script type="text/babel">
    const { useState, useEffect } = React;

    // --- アイコンコンポーネント (Lucide代替) ---
    const Icon = ({ children, size = 24, className = "" }) => (
        <svg 
            xmlns="http://www.w3.org/2000/svg" 
            width={size} 
            height={size} 
            viewBox="0 0 24 24" 
            fill="none" 
            stroke="currentColor" 
            strokeWidth="2" 
            strokeLinecap="round" 
            strokeLinejoin="round" 
            className={className}
        >
            {children}
        </svg>
    );

    const Icons = {
        Plus: (props) => <Icon {...props}><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></Icon>,
        History: (props) => <Icon {...props}><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"></path><path d="M3 3v5h5"></path><path d="M12 7v5l4 2"></path></Icon>,
        X: (props) => <Icon {...props}><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></Icon>,
        Save: (props) => <Icon {...props}><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path><polyline points="17 21 17 13 7 13 7 21"></polyline><polyline points="7 3 7 8 15 8"></polyline></Icon>,
        Trash2: (props) => <Icon {...props}><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></Icon>,
    };

    // --- 定数定義 ---
    const RANKS = ['A', 'K', 'Q', 'J', 'T', '9', '8', '7', '6', '5', '4', '3', '2'];
    const SUITS = [
        { symbol: '♠', color: 'text-gray-200', name: 's' },
        { symbol: '♥', color: 'text-red-500', name: 'h' },
        { symbol: '♦', color: 'text-blue-400', name: 'd' }, 
        { symbol: '♣', color: 'text-green-500', name: 'c' } 
    ];
    const POSITIONS_6MAX = ['SB', 'BB', 'UTG', 'HJ', 'CO', 'BTN'];

    // --- メインアプリ ---
    function App() {
        const [view, setView] = useState('input');
        const [hands, setHands] = useState([]);
        
        const [currentHand, setCurrentHand] = useState({
            id: null,
            timestamp: null,
            heroPos: 'BTN',
            holeCards: [null, null],
            board: [null, null, null, null, null],
            action: 'Open',
        });

        const [activeCardIndex, setActiveCardIndex] = useState(null);
        const [tempRank, setTempRank] = useState(null);

        // localStorageから読み込み
        useEffect(() => {
            const savedHands = localStorage.getItem('poker_hands');
            if (savedHands) {
                setHands(JSON.parse(savedHands));
            }
        }, []);

        // hands更新時にlocalStorageへ保存
        useEffect(() => {
            localStorage.setItem('poker_hands', JSON.stringify(hands));
        }, [hands]);

        const getCardDisplay = (card) => {
            if (!card) return <span className="text-gray-600">?</span>;
            const suitObj = SUITS.find(s => s.name === card.suit);
            return (
                <span className={`font-bold ${suitObj?.color || 'text-white'}`}>
                    {card.rank}{suitObj?.symbol}
                </span>
            );
        };

        const handleCardSelect = (rank, suit) => {
            const newCard = { rank, suit: suit.name };
            
            if (activeCardIndex !== null) {
                if (activeCardIndex < 2) {
                    const newHole = [...currentHand.holeCards];
                    newHole[activeCardIndex] = newCard;
                    setCurrentHand({ ...currentHand, holeCards: newHole });
                    if (activeCardIndex === 0) setActiveCardIndex(1);
                    else setActiveCardIndex(null);
                } else {
                    const newBoard = [...currentHand.board];
                    newBoard[activeCardIndex - 2] = newCard;
                    setCurrentHand({ ...currentHand, board: newBoard });
                    if (activeCardIndex - 2 < 4) setActiveCardIndex(activeCardIndex + 1);
                    else setActiveCardIndex(null);
                }
            }
            setTempRank(null);
        };

        const saveHand = () => {
            const newHand = {
                ...currentHand,
                id: Date.now(),
                timestamp: new Date().toLocaleString(),
            };
            setHands([newHand, ...hands]);
            resetHand();
            setView('history');
        };

        const resetHand = () => {
            setCurrentHand({
                id: null,
                timestamp: null,
                heroPos: 'BTN',
                holeCards: [null, null],
                board: [null, null, null, null, null],
                action: 'Open',
            });
            setActiveCardIndex(null);
            setTempRank(null);
        };

        const clearHistory = () => {
            if (confirm('履歴をすべて削除しますか？')) {
                setHands([]);
            }
        };

        // --- モーダルコンポーネント ---
        const CardInputModal = () => {
            if (activeCardIndex === null) return null;

            return (
                <div className="fixed inset-0 bg-black/80 z-50 flex items-end justify-center animate-[fadeIn_0.2s_ease-out] select-none">
                    <div className="bg-slate-900 w-full max-w-md p-4 rounded-t-2xl border-t border-slate-700 pb-8 animate-[slideUp_0.2s_ease-out]">
                        <div className="flex justify-between items-center mb-4">
                            <h3 className="text-white font-bold text-lg">
                                {activeCardIndex < 2 ? `Hand Card #${activeCardIndex + 1}` : `Board Card #${activeCardIndex - 1}`}
                            </h3>
                            <button onClick={() => setActiveCardIndex(null)} className="p-2 bg-slate-800 rounded-full active:bg-slate-700">
                                <Icons.X className="text-gray-400" />
                            </button>
                        </div>

                        {!tempRank ? (
                            <div className="grid grid-cols-4 gap-2 mb-2">
                                {RANKS.map(r => (
                                    <button
                                        key={r}
                                        onClick={() => setTempRank(r)}
                                        className="h-14 bg-slate-800 hover:bg-indigo-600 text-white font-bold text-xl rounded-lg active:scale-90 transition-transform touch-manipulation"
                                    >
                                        {r}
                                    </button>
                                ))}
                            </div>
                        ) : (
                            <div className="grid grid-cols-4 gap-4 py-4">
                                {SUITS.map(s => (
                                    <button
                                        key={s.name}
                                        onClick={() => handleCardSelect(tempRank, s)}
                                        className="h-24 bg-slate-800 hover:bg-slate-700 rounded-xl flex flex-col items-center justify-center active:scale-95 transition-transform border border-slate-700 touch-manipulation"
                                    >
                                        <span className={`text-5xl ${s.color}`}>{s.symbol}</span>
                                        <span className="text-white font-bold mt-2">{tempRank}</span>
                                    </button>
                                ))}
                                <button 
                                    onClick={() => setTempRank(null)}
                                    className="col-span-4 mt-2 py-4 bg-slate-800 rounded-lg text-slate-400 text-sm font-bold active:bg-slate-700"
                                >
                                    戻る（ランク再選択）
                                </button>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        const PositionSelector = () => (
            <div className="flex justify-between bg-slate-800 p-2 rounded-xl mb-4 overflow-x-auto gap-2 no-scrollbar touch-pan-x">
                {POSITIONS_6MAX.map(pos => (
                    <button
                        key={pos}
                        onClick={() => setCurrentHand({ ...currentHand, heroPos: pos })}
                        className={`flex-1 py-3 px-2 rounded-lg font-bold text-sm min-w-[50px] transition-colors whitespace-nowrap
                            ${currentHand.heroPos === pos 
                                ? 'bg-indigo-600 text-white shadow-lg shadow-indigo-500/30' 
                                : 'bg-slate-700 text-gray-400'}`}
                    >
                        {pos}
                    </button>
                ))}
            </div>
        );

        return (
            <div className="min-h-[100dvh] bg-slate-950 text-slate-100 font-sans select-none overflow-hidden">
                <div className="max-w-md mx-auto h-[100dvh] flex flex-col relative bg-slate-950 shadow-2xl">
                    
                    <header className="p-4 flex justify-between items-center border-b border-slate-800 bg-slate-900/50 backdrop-blur-sm sticky top-0 z-10 flex-shrink-0">
                        <h1 className="text-xl font-bold bg-gradient-to-r from-indigo-400 to-cyan-400 bg-clip-text text-transparent pointer-events-none">
                            Flash Recorder
                        </h1>
                        <div className="flex gap-2">
                            <button 
                                onClick={() => setView(view === 'input' ? 'history' : 'input')}
                                className="p-2 rounded-lg bg-slate-800 hover:bg-slate-700 transition-colors active:scale-95"
                            >
                                {view === 'input' ? <Icons.History size={20} /> : <Icons.Plus size={20} />}
                            </button>
                        </div>
                    </header>

                    {view === 'input' ? (
                        <main className="flex-1 p-4 flex flex-col gap-4 overflow-y-auto pb-safe">
                            
                            <section>
                                <label className="text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block">Hero Position</label>
                                <PositionSelector />
                            </section>

                            <section>
                                <label className="text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block">Hole Cards</label>
                                <div className="flex gap-3">
                                    {[0, 1].map(i => (
                                        <button
                                            key={i}
                                            onClick={() => setActiveCardIndex(i)}
                                            className={`flex-1 aspect-[2/3] max-w-[100px] rounded-xl border-2 flex items-center justify-center text-3xl shadow-lg transition-all active:scale-95
                                                ${currentHand.holeCards[i] 
                                                    ? 'bg-slate-800 border-indigo-500/50' 
                                                    : 'bg-slate-900 border-slate-700 border-dashed text-slate-700'}`}
                                        >
                                            {getCardDisplay(currentHand.holeCards[i])}
                                        </button>
                                    ))}
                                </div>
                            </section>

                            <section>
                                <label className="text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block">Board (Flop / Turn / River)</label>
                                <div className="flex gap-2">
                                    {[0, 1, 2].map(i => (
                                        <button
                                            key={i}
                                            onClick={() => setActiveCardIndex(i + 2)}
                                            className={`flex-1 aspect-[2/3] rounded-lg border flex items-center justify-center text-xl shadow-md transition-all active:scale-95
                                                ${currentHand.board[i] 
                                                    ? 'bg-slate-800 border-indigo-500/30' 
                                                    : 'bg-slate-900 border-slate-800 text-slate-700'}`}
                                        >
                                            {getCardDisplay(currentHand.board[i])}
                                        </button>
                                    ))}
                                    <div className="w-px bg-slate-800 mx-1"></div>
                                    {[3, 4].map(i => (
                                        <button
                                            key={i}
                                            onClick={() => setActiveCardIndex(i + 2)}
                                            className={`flex-1 aspect-[2/3] rounded-lg border flex items-center justify-center text-xl shadow-md transition-all active:scale-95
                                                ${currentHand.board[i] 
                                                    ? 'bg-slate-800 border-indigo-500/30' 
                                                    : 'bg-slate-900 border-slate-800 text-slate-700'}`}
                                        >
                                            {getCardDisplay(currentHand.board[i])}
                                        </button>
                                    ))}
                                </div>
                            </section>

                            <section>
                                <label className="text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block">Quick Action Note</label>
                                <div className="grid grid-cols-3 gap-2">
                                    {['RFI', '3Bet Pot', 'Call 3B', 'Multiway', 'Squeezed', 'Bluff'].map(tag => (
                                        <button
                                            key={tag}
                                            onClick={() => setCurrentHand({...currentHand, action: tag})}
                                            className={`py-3 px-1 rounded-lg text-sm font-bold border transition-all active:scale-95
                                                ${currentHand.action === tag 
                                                    ? 'bg-emerald-900/30 border-emerald-500/50 text-emerald-400' 
                                                    : 'bg-slate-800 border-transparent text-slate-400 hover:bg-slate-700'}`}
                                        >
                                            {tag}
                                        </button>
                                    ))}
                                </div>
                            </section>

                            <div className="mt-auto pt-6 pb-4">
                                <button
                                    onClick={saveHand}
                                    disabled={!currentHand.holeCards[0] && !currentHand.holeCards[1]}
                                    className="w-full py-4 bg-indigo-600 hover:bg-indigo-500 disabled:opacity-30 disabled:cursor-not-allowed text-white font-bold rounded-xl shadow-lg shadow-indigo-900/50 flex items-center justify-center gap-2 active:scale-[0.98] transition-all touch-manipulation"
                                >
                                    <Icons.Save size={20} />
                                    ハンドを記録
                                </button>
                                <button 
                                    onClick={resetHand}
                                    className="w-full mt-3 py-3 text-slate-500 hover:text-red-400 text-sm font-medium flex items-center justify-center gap-2 active:scale-95 transition-transform"
                                >
                                    <Icons.Trash2 size={16} /> 入力をクリア
                                </button>
                            </div>

                        </main>
                    ) : (
                        <main className="flex-1 p-4 overflow-y-auto pb-safe">
                            {hands.length === 0 ? (
                                <div className="text-center text-slate-600 mt-20 flex flex-col items-center">
                                    <Icons.History size={48} className="mb-4 opacity-50" />
                                    <p>記録されたハンドはありません</p>
                                </div>
                            ) : (
                                <div className="space-y-3 pb-20">
                                    {hands.map(hand => (
                                        <div key={hand.id} className="bg-slate-900 border border-slate-800 p-3 rounded-xl flex items-center gap-3">
                                            <div className="flex flex-col items-center min-w-[40px]">
                                                <span className="text-[10px] font-bold text-slate-500 uppercase">Hero</span>
                                                <span className="font-bold text-indigo-400">{hand.heroPos}</span>
                                            </div>
                                            
                                            <div className="h-8 w-px bg-slate-800"></div>

                                            <div className="flex-1 overflow-hidden">
                                                <div className="flex gap-1 mb-1">
                                                    <span className="bg-slate-800 px-1.5 py-0.5 rounded text-lg font-bold border border-slate-700 min-w-[36px] text-center">{getCardDisplay(hand.holeCards[0])}</span>
                                                    <span className="bg-slate-800 px-1.5 py-0.5 rounded text-lg font-bold border border-slate-700 min-w-[36px] text-center">{getCardDisplay(hand.holeCards[1])}</span>
                                                </div>
                                                <div className="flex gap-1 items-center overflow-x-auto no-scrollbar">
                                                    {hand.board.filter(c => c).length > 0 ? (
                                                        hand.board.filter(c => c).map((c, i) => (
                                                            <span key={i} className="text-sm bg-slate-950 px-1.5 py-0.5 rounded border border-slate-800/50">{getCardDisplay(c)}</span>
                                                        ))
                                                    ) : (
                                                        <span className="text-xs text-slate-600 pl-1">No Flop</span>
                                                    )}
                                                </div>
                                            </div>

                                            <div className="text-right flex flex-col items-end gap-1">
                                                <span className="inline-block text-[10px] text-emerald-400 font-bold px-2 py-0.5 bg-emerald-950/30 rounded border border-emerald-900/50 whitespace-nowrap">
                                                    {hand.action}
                                                </span>
                                                <span className="text-[10px] text-slate-600 font-mono">{hand.timestamp.split(' ')[1].slice(0, 5)}</span>
                                            </div>
                                        </div>
                                    ))}
                                    <div className="pt-4 text-center">
                                        <button onClick={clearHistory} className="text-xs text-red-500 underline">
                                            履歴を全削除
                                        </button>
                                    </div>
                                </div>
                            )}
                        </main>
                    )}

                    <CardInputModal />
                </div>
            </div>
        );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
</script>
</body>
</html>
